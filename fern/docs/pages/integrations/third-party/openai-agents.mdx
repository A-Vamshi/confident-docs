---
slug: integrations/third-party/openai-agents
subtitle: Use Confident AI for LLM observability and evals for OpenAI Agents
---

## Overview

[OpenAI Agents](https://github.com/openai/openai-agents-python) is a lightweight framework for creating agentic workflows using agent swarms, handoffs, and tool use. Confident AI also allows you to trace OpenAI Agent workflows with one line of code.

## Tracing Quickstart

<Steps>

<Step title="Install Dependencies">

Run the following command to install the required packages:

```bash
pip install -U deepeval openai-agents
```

</Step>

<Step title="Setup Confident AI Key">

Login to Confident AI using your Confident API key.

<CodeBlocks>

<CodeBlock language="bash">

```bash
deepeval login
```

</CodeBlock>

<CodeBlock language="python">

```python
import deepeval

deepeval.login("<your-confident-api-key>")

```

</CodeBlock>

</CodeBlocks>

</Step>

<Step title="Configure OpenAI Agents">

Add DeepEval's trace processor to OpenAI Agents.

```python main.py {1,3}
from deepeval.openai_agents import DeepEvalTracingProcessor

add_trace_processor(DeepEvalTracingProcessor())

# Replace with your agent code
agent = Agent(name="Assistant", instructions="You are a helpful assistant")
result = Runner.run_sync(agent, "Write a haiku about recursion in programming.")
```

<Note>
Now whenever you use OpenAI Agents, DeepEval will collect OpenAI Agents traces and publish them to Confident AI.
</Note>
</Step>

<Step title="Run OpenAI Agents">

Invoke your agent by executing the script:

```bash
python main.py
```

You can directly view the traces on [Confident AI](https://app.confident.ai) by clicking on the link in the output printed in the console.

</Step>

</Steps>

## Advanced Usage

### Logging threads

Threads are used to group related traces together, and are useful for chat apps, agents, or any multi-turn interactions. You can learn more about [threads](/docs/llm-tracing/advanced-features/threads) here. You can set the `thread_id` in as `group_id` in the `trace` context.

```python main.py
...
async def main1():
  with trace(workflow_name="test_workflow_1", group_id="test_group_id_1"):
      result = await Runner.run(weather_agent, user_query, metric_collection="test_collection_1")
```

### Logging metadata

You can also set the `metadata` in the `trace` context.

```python main.py
...
with trace(workflow_name="test_workflow_1", metadata={"test_metadata_1": "test_metadata_1"}):
    result = await Runner.run(weather_agent, user_query, metric_collection="test_collection_1")
```

### Overriding trace attributes

If you want to override the input, output, or any other attribute for the current trace, you can use the `update_current_trace` function:

```python main.py
...
from deepeval.tracing.context import update_current_trace

async def main1():
    with trace(workflow_name="test_workflow_1", metadata={"test_metadata_1": "test_metadata_1"}):
        response_1 = await Runner.run(weather_agent, "Hola, ¿cómo estás?")
        
        update_current_trace(
          name="New name",
          input="New input",
          output="New output",
          metadata={"New key": "New value"}
        )

```

### Streaming responses

Confident AI handles both asynchronous workflows and streamed responses. The following example shows how to trace streamed responses with OpenAI Agents.

```python main.py
import asyncio
from deepeval.openai_agents import DeepEvalTracingProcessor
from agents import add_trace_processor, Agent, Runner
add_trace_processor(DeepEvalTracingProcessor())

weather_agent = Agent(
    name="Weather Agent",
    instructions="You are a weather agent. You are given a question about the weather and you need to answer it.",
)

async def main():
    result = Runner.run_streamed(weather_agent, "What's the weather in UK?", thread_id="test")
    async for chunk in result.stream_events():
        print(chunk, end="", flush=True)

asyncio.run(main())
```

### Overwrite trace attributes

If you are using `trace` context to set the trace attributes, the trace attributes such as the input will be the **input of the first agent run** while the output will be the **output of the last agent run**.

If you want to set override the input, output, or any other attribute for the current trace, you can use the `update_current_trace` function:

```python main.py
from deepeval.tracing.context import update_current_trace

async def main1():
    with trace(workflow_name="test_workflow_1", group_id="test_group_id_1", metadata={"test_metadata_1": "test_metadata_1"}):
        user_query = "What's the weather like in London today?"
        response_1 = await Runner.run(triage_agent, "Hola, ¿cómo estás?", metric_collection="test_collection_1")
        response_2 = await Runner.run(weather_agent, user_query, metric_collection="test_collection_1")
        update_current_trace(
          name="New name",
          input="New input",
          output="New output",
          metadata={"New key": "New value"}
        )
```

<Note>
The `thread_id` and `metadata` will ALSO override the `trace` context's `group_id` and `metadata` respectively.
</Note>



<Accordion title='View Trace Attributes'>
<ParamField path="name" type="str" required={false}>
  The name of the trace. [Learn more](/docs/llm-tracing/advanced-features/name).
</ParamField>

<ParamField path="tags" type="List[str]" required={false}>
  Tags are string labels that help you group related traces. [Learn
  more](/docs/llm-tracing/advanced-features/tags).
</ParamField>

<ParamField path="metadata" type="Dict" required={false}>
  Attach any metadata to the trace. [Learn
  more](/docs/llm-tracing/advanced-features/metadata).
</ParamField>

<ParamField path="thread_id" type="str" required={false}>
  Supply the thread or conversation ID to view and evaluate conversations.
  [Learn more](/docs/llm-tracing/advanced-features/threads).
</ParamField>

<ParamField path="user_id" type="str" required={false}>
  Supply the user ID to enable user analytics. [Learn
  more](/docs/llm-tracing/advanced-features/users).
</ParamField>

<Info>
  Each attribute is **optional**, and works the same way as the [native tracing
  features](/docs/llm-tracing/introduction) on Confident AI.
</Info>
</Accordion>
