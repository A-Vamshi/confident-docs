---
slug: integrations/third-party/openai-agents
subtitle: Use Confident AI for LLM observability and evals for OpenAI Agents
---

## Overview

[OpenAI Agents](https://github.com/openai/openai-agents-python) is a lightweight framework for creating agentic workflows using agent swarms, handoffs, and tool use. Confident AI also allows you to trace OpenAI Agent workflows with one line of code.

## Tracing Quickstart

<Steps>

<Step title="Install Dependencies">

Run the following command to install the required packages:

<CodeBlocks> 

<CodeBlock language="python">

```python
pip install -U deepeval openai-agents
```

</CodeBlock>

<CodeBlock language="typescript">

```typescript
npm install deepeval-ts @openai/agents
```

</CodeBlock>

</CodeBlocks>

</Step>

<Step title="Setup Confident AI Key">

Login to Confident AI using your Confident API key.

<CodeBlocks>

<CodeBlock title="Env" language="bash">

```bash
export CONFIDENT_API_KEY="<your-confident-api-key>"
```

</CodeBlock>

<CodeBlock language="bash" title="Bash">

```bash
deepeval login
```

</CodeBlock>

<CodeBlock language="python">

```python
import deepeval

deepeval.login("<your-confident-api-key>")

```

</CodeBlock>

</CodeBlocks>

</Step>

<Step title="Configure OpenAI Agents">

Add DeepEval's trace processor to OpenAI Agents.

<CodeBlocks>

<CodeBlock language="python">

```python main.py {4}
from deepeval.openai_agents import DeepEvalTracingProcessor
from agents import add_trace_processor, Agent, Runner

add_trace_processor(DeepEvalTracingProcessor())

agent = Agent(name="Assistant", instructions="You are a helpful assistant")
result = Runner.run_sync(agent, "Write a haiku about recursion in programming.")
```

</CodeBlock>

<CodeBlock language="typescript">

```typescript {1,4-5}
import { DeepEvalTracingProcessor } from "deepeval/integrations/openai-agents";
import { Agent, run, addTraceProcessor } from "@openai/agents";

const processor = new DeepEvalTracingProcessor();
addTraceProcessor(processor);

const agent = new Agent({ name: "Assistant", instructions: "You are a helpful assistant" });
const result = await run(agent, "Write a haiku about recursion in programming.");
```

</CodeBlock>

</CodeBlocks>

<Note>
Now whenever you use OpenAI Agents, DeepEval will collect OpenAI Agents traces and publish them to Confident AI.
</Note>
</Step>

<Step title="Run OpenAI Agents">

Invoke your agent by executing the script:

<CodeBlocks >

<CodeBlock language="python">

```python
python main.py
```

</CodeBlock>

<CodeBlock language="typescript">

```typescript
npx ts-node
```

</CodeBlock>

</CodeBlocks>

You can directly view the traces on [Confident AI](https://app.confident.ai) by clicking on the link in the output printed in the console.

</Step>

</Steps>

## Advanced Usage

### Logging threads

Threads are used to group related traces together, and are useful for chat apps, agents, or any multi-turn interactions. You can learn more about [threads](/docs/llm-tracing/features/threads) here. You can set the `thread_id` in as `group_id` in the `trace` context.

<CodeBlocks>

<CodeBlock language="python">

```python main.py {7}
from deepeval.openai_agents import DeepEvalTracingProcessor
from agents import add_trace_processor, Agent, Runner, trace

add_trace_processor(DeepEvalTracingProcessor())
agent = Agent(name="Assistant", instructions="You are a helpful assistant")

with trace(workflow_name="test_workflow_1", group_id="test_group_id_1"):
      result = Runner.run_sync(agent, "Write a haiku about recursion in programming.")
```

</CodeBlock>

<CodeBlock language="typescript">

```typescript
import { DeepEvalTracingProcessor } from "deepeval/integrations/openai-agents";
import { Agent, run, addTraceProcessor } from "@openai/agents";
import { setTracingContext } from "deepeval-ts/tracing";

const processor = new DeepEvalTracingProcessor();
addTraceProcessor(processor);

const main = async () => {
  await setTracingContext(
    {
      threadId: "test_thread_id_1",
      userId: "new_user_id",
    },
    async () => {
      const result = await run(agent, "Write a haiku about recursion in programming.");
    }
  );
};

main();
```

</CodeBlock>

</CodeBlocks>

### Logging metadata

You can also set the `metadata` in the `trace` context.

<CodeBlocks>

<CodeBlock language="python">

```python main.py {7}
from deepeval.openai_agents import DeepEvalTracingProcessor
from agents import add_trace_processor, Agent, Runner, trace

add_trace_processor(DeepEvalTracingProcessor())
agent = Agent(name="Assistant", instructions="You are a helpful assistant")

with trace(workflow_name="test_workflow_1", metadata={"test_metadata_1": "test_metadata_1"}):
      result = Runner.run_sync(agent, "Write a haiku about recursion in programming.")
```

</CodeBlock>

<CodeBlock language="typescript">

```typescript
import { DeepEvalTracingProcessor } from "deepeval/integrations/openai-agents";
import { Agent, run, addTraceProcessor } from "@openai/agents";
import { setTracingContext } from "deepeval-ts/tracing";

const processor = new DeepEvalTracingProcessor();
addTraceProcessor(processor);

const main = async () => {
  await setTracingContext(
    {
      metadata={ test_metadata_1: "test_metadata_1" }
    },
    async () => {
      const result = await run(agent, "Write a haiku about recursion in programming.");
    }
  );
};

main();
```

</CodeBlock>

</CodeBlocks>

### Streaming responses

Confident AI handles both asynchronous workflows and streamed responses. The following example shows how to trace streamed responses with OpenAI Agents.

<CodeBlocks>

<CodeBlock language="python">
```python main.py
from deepeval.openai_agents import DeepEvalTracingProcessor
from agents import add_trace_processor, Agent, Runner
import asyncio

add_trace_processor(DeepEvalTracingProcessor())

weather_agent = Agent(
    name="Weather Agent",
    instructions="You are a weather agent. You are given a question about the weather and you need to answer it.",
)

async def main():
    result = Runner.run_streamed(weather_agent, "What's the weather in UK?")
    async for chunk in result.stream_events():
        print(chunk, end="", flush=True)

asyncio.run(main())
```

</CodeBlock>

<CodeBlock language="typescript">

```typescript
import { DeepEvalTracingProcessor } from "deepeval/integrations/openai-agents";
import { Agent, run, addTraceProcessor } from "@openai/agents";
import { setTracingContext } from "deepeval-ts/tracing";

const processor = new DeepEvalTracingProcessor();
addTraceProcessor(processor);

const main = async () => {
  await setTracingContext(
    {
      threadId: "thread_1",
    },
    async () => {
      const result = await run(agent, "What's the weather in UK?", {stream: true});
  
      for await (const chunk of result) {
        console.log(chunk)
      }
    }
  );
};

main();
```

</CodeBlock>

</CodeBlocks>

### Overwrite trace attributes

If you are using `trace` context to set the trace attributes, the trace attributes such as the input will be the **input of the first agent run** while the output will be the **output of the last agent run**.

If you want to set override the input, output, or any other attribute for the current trace, you can use the `update_current_trace` function:

<CodeBlocks>

<CodeBlock language="python">

```python main.py {10}
from deepeval.openai_agents import DeepEvalTracingProcessor
from agents import add_trace_processor, Agent, Runner, trace
from deepeval.tracing.context import update_current_trace

add_trace_processor(DeepEvalTracingProcessor())
agent = Agent(name="Assistant", instructions="You are a helpful assistant")

with trace(workflow_name="test_workflow_1", metadata={"test_metadata_1": "test_metadata_1"}):
    response_1 = Runner.run_sync(agent, "Hola, ¿cómo estás?")
    update_current_trace(
        name="New name",
        input="New input",
        output="New output",
        metadata={"New key": "New value"}
    )
```

</CodeBlock>

<CodeBlock language="typescript">

```typescript
import { DeepEvalTracingProcessor } from "deepeval/integrations/openai-agents";
import { Agent, run, addTraceProcessor } from "@openai/agents";
import { setTracingContext, updateCurrentTrace } from "deepeval-ts/tracing";

const processor = new DeepEvalTracingProcessor();
addTraceProcessor(processor);

const main = async () => {
  await setTracingContext(
    {
      metadata={ test_metadata_1: "test_metadata_1" }
    },
    async () => {
      const result = await run(agent, "Hola, ¿cómo estás?");
      updateCurrentTrace({
        name: "New name",
        input: "New input",
        output: "New output",
        metadata: {newKey: "New value"}
      });
    }
  );
};

main();
```

</CodeBlock>

</CodeBlocks>

<Note>
  The `thread_id` and `metadata` will ALSO override the `trace` context's
  `group_id` and `metadata` respectively.
</Note>

<Accordion title='View Trace Attributes'>
<ParamField path="name" type="str" required={false}>
  The name of the trace. [Learn more](/docs/llm-tracing/features/name).
</ParamField>

<ParamField path="tags" type="List[str]" required={false}>
  Tags are string labels that help you group related traces. [Learn
  more](/docs/llm-tracing/features/tags).
</ParamField>

<ParamField path="metadata" type="Dict" required={false}>
  Attach any metadata to the trace. [Learn
  more](/docs/llm-tracing/features/metadata).
</ParamField>

<ParamField path="thread_id" type="str" required={false}>
  Supply the thread or conversation ID to view and evaluate conversations.
  [Learn more](/docs/llm-tracing/features/threads).
</ParamField>

<ParamField path="user_id" type="str" required={false}>
  Supply the user ID to enable user analytics. [Learn
  more](/docs/llm-tracing/features/users).
</ParamField>

<Info>
  Each attribute is **optional**, and works the same way as the [native tracing
  features](/docs/llm-tracing/introduction) on Confident AI.
</Info>
</Accordion>

### Logging prompts

If you are managing prompts[/docs/llm-evaluation/prompt-management/version-prompts] on Confident AI and wish to log them, pass your `Prompt` object to the DeepEval's `Agent` wrapper.

<CodeBlocks >

<CodeBlock language="python">

```python main.py {13}
from agents import Runner, add_trace_processor
from deepeval.prompt import Prompt
from deepeval.openai_agents import DeepEvalTracingProcessor, Agent

add_trace_processor(DeepEvalTracingProcessor())

prompt = Prompt(alias="<prompt-alias>")
prompt.pull(version="00.00.01")

spanish_agent = Agent(
    name="Spanish agent",
    instructions=prompt.interpolate(),
    confident_prompt=prompt,
)
Runner.run_sync(spanish_agent, "¿Cómo estás?")
```

</CodeBlock>

<CodeBlock language="typescript">

```typescript
import { DeepEvalTracingProcessor } from "deepeval/integrations/openai-agents";
import { Agent, run, addTraceProcessor } from "@openai/agents";
import { setTracingContext } from "deepeval-ts/tracing";
import { Prompt } from "deepeval-ts";

const prompt = new Prompt({ alias: "my-prompt" });
prompt.pull({ version: "00.00.01" });

const processor = new DeepEvalTracingProcessor();
addTraceProcessor(processor);

const main = async () => {
  await setTracingContext(
    {
      llmSpanContext: { 
        prompt: prompt 
      }
    },
    async () => {
      const result = await run(agent, prompt.interpolate({ name: "Jhon" }));
    }
  );
};

main();
```

</CodeBlock>

</CodeBlocks>

<Note>
  Logging prompts lets you attribute specific prompts to OpenAI Agent LLM spans.
  Be sure to **pull the prompt** before logging it, otherwise the prompt will
  not be visible on Confident AI.
</Note>

## Evals Usage

### Online evals

You can run [online evals](/docs/llm-evaluation/online-evals) on your OpenAI Agent, which will run evaluations on all incoming traces on Confident AI’s servers. This is the recommended approach, especially if your agent is in production.

<Steps>

<Step title="Create metric collection">

Create a metric collection on [Confident AI](https://app.confident.ai) with the metrics you wish to use to evaluate your OpenAI Agent.

<Accordion title='Click to see supported metrics for OpenAI Agents'>

Confident AI supports evaluating the input-output pairs of OpenAI Agent spans and traces, which means your metric collections must only contain metrics that only require the input and output for evaluation. These metrics include:

- [Answer Relevancy](https://www.confident-ai.com/docs/metrics/single-turn/answer-relevancy-metric)
- [Task Completion](https://www.confident-ai.com/docs/metrics/single-turn/task-completion-metric)
- [GEval](https://deepeval.com/docs/metrics-llm-evals)
- [Bias](https://www.confident-ai.com/docs/metrics/single-turn/bias-metric)
- [Toxicity](https://www.confident-ai.com/docs/metrics/single-turn/toxicity-metric)

<Info>
  If you're looking to use other metrics, setup Confident AI's [native
  tracing](/docs/llm-tracing/introduction) instead.
</Info>

</Accordion>
<Frame caption="Create metric collection">
  <video
    data-video="metrics.createCollection"
    controls
    autoPlay
  />
</Frame>

</Step>

<Step title="Run evals">

You can run evals at both the trace and span level. We recommend creating separate [metric collections](/docs/metrics/metric-collections) for each component, since each requires its own evaluation criteria and metrics.

<Warning>
  Agent span metrics are currently only supported for `Runner.run` and
  `Runner.run_sync`.
</Warning>

<Tabs>

<Tab title="Agent Span">

Replace your `Agent` with DeepEval's and supply the metric collection name to run evals on the agent span level.

<CodeBlocks >

<CodeBlock language="python">

```python main.py {10}
import asyncio
from agents import Runner, add_trace_processor
from deepeval.openai_agents import Agent, DeepEvalTracingProcessor

add_trace_processor(DeepEvalTracingProcessor())

weather_agent = Agent(
    name="Weather Agent",
    instructions="You are a weather agent. You are given a question about the weather and you need to answer it.",
    agent_metric_collection="test_collection_1",
)

async def main():
    result = await Runner.run(weather_agent, "What's the weather in UK?")
    print(result.final_output)

asyncio.run(main())
```

</CodeBlock>

<CodeBlock language="typescript">

```typescript
import { DeepEvalTracingProcessor } from "deepeval/integrations/openai-agents";
import { Agent, run, addTraceProcessor } from "@openai/agents";
import { setTracingContext } from "deepeval-ts/tracing";

const processor = new DeepEvalTracingProcessor();
addTraceProcessor(processor);

const main = async () => {
  await setTracingContext(
    {
      agentSpanContext: {
        metricCollection: "agent-metric-collection"
      }
    },
    async () => {
      const result = await run(agent, "What's the weather in UK?");
    }
  );
};

main();
```

</CodeBlock>

</CodeBlocks>

</Tab>

<Tab title="LLM Span">

Replace your Pydantic `Agent` with DeepEval’s and your supply the metric collection name to `Agent` to run evals on the LLM span level.

<CodeBlocks >

<CodeBlock language="python">

```python main.py {10}
import asyncio
from agents import Runner, add_trace_processor
from deepeval.openai_agents import Agent, DeepEvalTracingProcessor

add_trace_processor(DeepEvalTracingProcessor())

weather_agent = Agent(
    name="Weather Agent",
    instructions="You are a weather agent. You are given a question about the weather and you need to answer it.",
    llm_metric_collection="test_collection_1",
)

async def main():
    result = await Runner.run(weather_agent, "What's the weather in UK?")
    print(result.final_output)

asyncio.run(main())
```

</CodeBlock>

<CodeBlock language="typescript">

```typescript
import { DeepEvalTracingProcessor } from "deepeval/integrations/openai-agents";
import { Agent, run, addTraceProcessor } from "@openai/agents";
import { setTracingContext } from "deepeval-ts/tracing";

const processor = new DeepEvalTracingProcessor();
addTraceProcessor(processor);

const main = async () => {
  await setTracingContext(
    {
      llmSpanContext: {
        metricCollection: "llm-metric-collection"
      }
    },
    async () => {
      const result = await run(agent, "What's the weather in UK?");
    }
  );
};

main();
```

</CodeBlock>

</CodeBlocks>

</Tab>

<Tab title="Tool Span">

Replace the `function_tool` decorator with DeepEval's wrapper, and provide the metric collection name to run evals on the tool span level.

<CodeBlocks >

<CodeBlock language="python">

```python main.py {7}
import asyncio
from agents import Agent, Runner, add_trace_processor
from deepeval.openai_agents import function_tool, DeepEvalTracingProcessor

add_trace_processor(DeepEvalTracingProcessor())

@function_tool(metric_collection="test_collection_1")
def get_weather(city: str) -> str:
    return "The weather in " + city + " is sunny."

weather_agent = Agent(
    name="Weather Agent",
    instructions="You are a weather agent. You are given a question about the weather and you need to answer it.",
    tools=[get_weather],
)

async def main():
    result = await Runner.run(weather_agent, "What's the weather in UK?")
    print(result.final_output)

asyncio.run(main())
```

</CodeBlock>

<CodeBlock language="typescript">

```typescript
import { DeepEvalTracingProcessor } from "deepeval/integrations/openai-agents";
import { Agent, run, addTraceProcessor } from "@openai/agents";
import { setTracingContext } from "deepeval-ts/tracing";

const processor = new DeepEvalTracingProcessor();
addTraceProcessor(processor);

const main = async () => {
  await setTracingContext(
    {
      llmSpanContext: {
        toolsMetricCollection: "tools-metric-collection",
      }
    },
    async () => {
      const result = await run(agent, "What's the weather in UK?");
    }
  );
};

main();
```

</CodeBlock>

</CodeBlocks>

</Tab>
</Tabs>

<Success>
  All incoming traces and spans will now be evaluated using metrics from your
  metric collection.
</Success>

</Step>
</Steps>
